<!DOCTYPE html>
<html>
<head>
    <title>SmartRace Live Daten</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            background-color: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #e9e9e9;
        }
        .pb {
            background-color: #e6ffe6 !important;
            font-weight: bold;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .last-update {
            text-align: right;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SmartRace Live Daten</h1>
        <div class="last-update" id="last-update">Letzte Aktualisierung: Nie</div>
        <div id="data-container">
            <table id="lap-table">
                <thead>
                    <tr>
                        <th>Zeitstempel</th>
                        <th>Fahrer</th>
                        <th>Auto</th>
                        <th>Runde</th>
                        <th>Rundenzeit</th>
                        <th>PB</th>
                    </tr>
                </thead>
                <tbody id="lap-data">
                    <!-- Daten werden hier eingefügt -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function fetchData() {
            fetch('/api/laps')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('lap-data');
                    tableBody.innerHTML = '';

                    const now = new Date();
                    document.getElementById('last-update').textContent =
                        `Letzte Aktualisierung: ${now.toLocaleString()}`;

                    if (data.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = '<td colspan="6" style="text-align: center;">Keine Daten verfügbar</td>';
                        tableBody.appendChild(row);
                        return;
                    }

                    data.forEach(lap => {
                        const row = document.createElement('tr');
                        if (lap.lap_pb) {
                            row.classList.add('pb');
                        }

                        const timestamp = new Date(lap.timestamp).toLocaleString();
                        row.innerHTML = `
                            <td>${timestamp}</td>
                            <td>${lap.driver_name || 'Unbekannt'}</td>
                            <td>${lap.car_name || 'Unbekannt'}</td>
                            <td>${lap.lap}</td>
                            <td>${lap.laptime}</td>
                            <td>${lap.lap_pb ? '✓' : '✗'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Fehler beim Abrufen der Daten:', error);
                    document.getElementById('last-update').textContent =
                        `Fehler beim Laden der Daten: ${error.message}`;
                });
        }

        // Daten alle 3 Sekunden aktualisieren
        fetchData();
        setInterval(fetchData, 3000);
    </script>
</body>
</html>
