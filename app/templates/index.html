<!DOCTYPE html>
<html>
<head>
    <title>SmartRace Live Daten</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        tr.pb { background-color: #e6ffe6; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .last-update { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <div class="header">
        <h1>SmartRace Live Daten</h1>
        <div class="last-update" id="lastUpdate">Letzte Aktualisierung: -</div>
    </div>

    <table id="lapTable">
        <thead>
            <tr>
                <th>Zeit</th>
                <th>Fahrer</th>
                <th>Fahrzeug</th>
                <th>Runde</th>
                <th>Rundenzeit</th>
                <th>PB</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Daten werden hier dynamisch eingefügt -->
        </tbody>
    </table>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('/api/laps');
                const data = await response.json();
                const tableBody = document.getElementById('tableBody');
                const lastUpdate = document.getElementById('lastUpdate');

                // Tabelle leeren
                tableBody.innerHTML = '';

                // Aktualisierungszeit setzen
                lastUpdate.textContent = `Letzte Aktualisierung: ${new Date().toLocaleString()}`;

                // Daten einfügen
                data.forEach(lap => {
                    const row = document.createElement('tr');
                    if (lap.lap_pb) {
                        row.classList.add('pb');
                    }

                    const timestamp = new Date(lap.timestamp).toLocaleString();
                    row.innerHTML = `
                        <td>${timestamp}</td>
                        <td>${lap.driver_name}</td>
                        <td>${lap.car_name}</td>
                        <td>${lap.lap}</td>
                        <td>${lap.laptime}</td>
                        <td>${lap.lap_pb ? 'Ja' : 'Nein'}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Fehler beim Laden der Daten:', error);
            }
        }

        // Initialen Daten laden und dann alle 3 Sekunden aktualisieren
        fetchData();
        setInterval(fetchData, 3000);
    </script>
</body>
</html>
